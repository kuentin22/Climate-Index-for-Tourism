# 2ï¸âƒ£ Formatar la columna 'percent_nuvolositat'
dades$percent_nuvolositat <- sapply(dades$percent_nuvolositat, formata_nuvolositat)
# 3ï¸âƒ£ Eliminar la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# Guardem el fitxer corregit a la carpeta "Corregits"
write_xlsx(dades, path = fitxer_output)
# Missatge per indicar el progrÃ©s
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
print("ğŸš€ Processament finalitzat per a tots els fitxers.")
formata_nuvolositat <- function(x) {
x_sense_punts <- gsub("[.,]", "", x)  # Eliminar punts i comes
# Si tÃ© exactament 17 dÃ­gits, eliminem el primer dÃ­git
if (nchar(x_sense_punts) == 17) {
x_sense_punts <- substr(x_sense_punts, 2, nchar(x_sense_punts))
}
# Si tÃ© mÃ©s de 10 dÃ­gits, dividir per 1e12 per ajustar el format
if (nchar(x_sense_punts) > 10) {
num <- as.numeric(x_sense_punts)
return(formatC(num / 1e18, digits = 3, format = "f", decimal.mark = ","))
}
return(x)  # Retornar el valor original si no cal formatar
}
# Bucle per processar els fitxers des de 2000 fins a 2022
for (any in 2000:2022) {
# Noms dels fitxers d'entrada i sortida
fitxer_input <- paste0(ruta_input, "Taula_nuvolositat_", any, "_Andorra.xlsx")
fitxer_output <- paste0(ruta_output, "Taula_nuvolositat_", any, "_Andorra_CORREGIT.xlsx")
# Verifiquem si el fitxer existeix
if (file.exists(fitxer_input)) {
# Llegim el fitxer Excel de la fulla 'Sheet1'
dades <- read_excel(path = fitxer_input, sheet = "Sheet1")
# 1ï¸âƒ£ Netejar la columna 'date'
dades$date <- sapply(dades$date, neteja_data)
# 2ï¸âƒ£ Formatar la columna 'percent_nuvolositat'
dades$percent_nuvolositat <- sapply(dades$percent_nuvolositat, formata_nuvolositat)
# 3ï¸âƒ£ Eliminar la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# Guardem el fitxer corregit a la carpeta "Corregits"
write_xlsx(dades, path = fitxer_output)
# Missatge per indicar el progrÃ©s
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
print("ğŸš€ Processament finalitzat per a tots els fitxers.")
library(tidyverse)
library(readxl)
library(writexl)
library(tidyverse)
library(readxl)
library(writexl)
ruta_input <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Originals/"
ruta_output <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Corregits/"
# âœ… FunciÃ³ per formatar la velocitat del vent
formata_velocitat <- function(x) {
x_sense_punts <- gsub("[.,]", "", x)  # Elimina punts i comes
# Si tÃ© exactament 17 dÃ­gits, eliminem el primer dÃ­git
if (nchar(x_sense_punts) == 17) {
x_sense_punts <- substr(x_sense_punts, 2, nchar(x_sense_punts))
}
# Si tÃ© mÃ©s de 10 dÃ­gits, dividir per 1e12 per ajustar el format
if (nchar(x_sense_punts) > 10) {
num <- as.numeric(x_sense_punts)
return(formatC(num / 1e12, digits = 3, format = "f", decimal.mark = ","))
}
return(x)  # Retorna l'original si no cal formatar
}
# ğŸš€ Bucle per processar els fitxers de 1981 fins a 2024
for (any in 1981:2024) {
# ğŸ“¥ Fitxers d'entrada i sortida
fitxer_input <- paste0(ruta_input, "Taula_velocitat_vent_", any, "_Andorra.xlsx")
fitxer_output <- paste0(ruta_output, "Taula_velocitat_vent_", any, "_Andorra_CORREGIT.xlsx")
# ğŸ” Verifiquem si el fitxer existeix
if (file.exists(fitxer_input)) {
# ğŸ“Š Llegim el fitxer Excel (fulla Sheet1)
dades <- read_excel(path = fitxer_input, sheet = "Sheet1")
# ğŸ’¨ Formatar la columna 'wind_speed_m_s'
if ("wind_speed_m_s" %in% colnames(dades)) {
dades$wind_speed_m_s <- sapply(dades$wind_speed_m_s, formata_velocitat)
}
# ğŸ—‘ï¸ Elimina la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# ğŸ’¾ Guardem el fitxer corregit
write_xlsx(dades, path = fitxer_output)
# âœ… Missatge d'estat
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
print("ğŸš€ Processament finalitzat per a tots els fitxers.")
formata_velocitat <- function(x) {
x_sense_punts <- gsub("[.,]", "", x)  # Elimina punts i comes
# Si tÃ© exactament 17 dÃ­gits, eliminem el primer dÃ­git
if (nchar(x_sense_punts) == 17) {
x_sense_punts <- substr(x_sense_punts, 2, nchar(x_sense_punts))
}
# Si tÃ© mÃ©s de 10 dÃ­gits, dividir per 1e12 per ajustar el format
if (nchar(x_sense_punts) > 10) {
num <- as.numeric(x_sense_punts)
return(formatC(num / 1e12, digits = 3, format = "f", decimal.mark = ","))
}
return(x)  # Retorna l'original si no cal formatar
}
# ğŸš€ Bucle per processar els fitxers de 1981 fins a 2024
for (any in 1981:2024) {
# ğŸ“¥ Fitxers d'entrada i sortida
fitxer_input <- paste0(ruta_input, "Taula_velocitat_vent_", any, "_Andorra.xlsx")
fitxer_output <- paste0(ruta_output, "Taula_velocitat_vent_", any, "_Andorra_CORREGIT.xlsx")
# ğŸ” Verifiquem si el fitxer existeix
if (file.exists(fitxer_input)) {
# ğŸ“Š Llegim el fitxer Excel (fulla Sheet1)
dades <- read_excel(path = fitxer_input, sheet = "Sheet1")
# ğŸ—“ï¸ Neteja la columna 'date'
if ("date" %in% colnames(dades)) {
dades$date <- sapply(dades$date, neteja_data)
}
# ğŸ’¨ Formatar la columna 'wind_speed_m_s'
if ("wind_speed_m_s" %in% colnames(dades)) {
dades$wind_speed_m_s <- sapply(dades$wind_speed_m_s, formata_velocitat)
}
# ğŸ—‘ï¸ Elimina la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# ğŸ’¾ Guardem el fitxer corregit
write_xlsx(dades, path = fitxer_output)
# âœ… Missatge d'estat
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
# âœ… FunciÃ³ per netejar la data (elimina tot desprÃ©s del primer espai)
neteja_data <- function(data) {
return(sub(" .*", "", data))
}
# âœ… FunciÃ³ per formatar la velocitat del vent
formata_velocitat <- function(x) {
x_sense_punts <- gsub("[.,]", "", x)  # Elimina punts i comes
# Si tÃ© exactament 17 dÃ­gits, eliminem el primer dÃ­git
if (nchar(x_sense_punts) == 17) {
x_sense_punts <- substr(x_sense_punts, 2, nchar(x_sense_punts))
}
# Si tÃ© mÃ©s de 10 dÃ­gits, dividir per 1e12 per ajustar el format
if (nchar(x_sense_punts) > 10) {
num <- as.numeric(x_sense_punts)
return(formatC(num / 1e12, digits = 3, format = "f", decimal.mark = ","))
}
return(x)  # Retorna l'original si no cal formatar
}
# ğŸš€ Bucle per processar els fitxers de 1981 fins a 2024
for (any in 1981:2024) {
# ğŸ“¥ Fitxers d'entrada i sortida
fitxer_input <- paste0(ruta_input, "Taula_velocitat_vent_", any, "_Andorra.xlsx")
fitxer_output <- paste0(ruta_output, "Taula_velocitat_vent_", any, "_Andorra_CORREGIT.xlsx")
# ğŸ” Verifiquem si el fitxer existeix
if (file.exists(fitxer_input)) {
# ğŸ“Š Llegim el fitxer Excel (fulla Sheet1)
dades <- read_excel(path = fitxer_input, sheet = "Sheet1")
# ğŸ—“ï¸ Neteja la columna 'date'
if ("date" %in% colnames(dades)) {
dades$date <- sapply(dades$date, neteja_data)
}
# ğŸ’¨ Formatar la columna 'wind_speed_m_s'
if ("wind_speed_m_s" %in% colnames(dades)) {
dades$wind_speed_m_s <- sapply(dades$wind_speed_m_s, formata_velocitat)
}
# ğŸ—‘ï¸ Elimina la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# ğŸ’¾ Guardem el fitxer corregit
write_xlsx(dades, path = fitxer_output)
# âœ… Missatge d'estat
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
print("ğŸš€ Processament finalitzat per a tots els fitxers.")
ruta_input <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Originals/"
ruta_output <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Corregits/"
# âœ… FunciÃ³ per netejar la data (elimina tot desprÃ©s del primer espai)
neteja_data <- function(data) {
return(sub(" .*", "", data))
}
# âœ… FunciÃ³ per formatar la velocitat del vent
formata_velocitat <- function(x) {
x_sense_punts <- gsub("[.,]", "", x)  # Elimina punts i comes
# Convertim a numÃ¨ric
num <- as.numeric(x_sense_punts)
# Si tÃ© mÃ©s de 12 dÃ­gits, dividim per 1e15 per ajustar el format
if (!is.na(num) && nchar(x_sense_punts) > 12) {
return(formatC(num / 1e15, digits = 3, format = "f", decimal.mark = ","))
}
# Si Ã©s un nÃºmero petit, simplement el retornem amb 3 decimals
return(formatC(num, digits = 3, format = "f", decimal.mark = ","))
}
# ğŸš€ Bucle per processar els fitxers de 1981 fins a 2024
for (any in 1981:2024) {
# ğŸ“¥ Fitxers d'entrada i sortida
fitxer_input <- paste0(ruta_input, "Taula_velocitat_vent_", any, "_Andorra.xlsx")
fitxer_output <- paste0(ruta_output, "Taula_velocitat_vent_", any, "_Andorra_CORREGIT.xlsx")
# ğŸ” Verifiquem si el fitxer existeix
if (file.exists(fitxer_input)) {
# ğŸ“Š Llegim el fitxer Excel (fulla Sheet1)
dades <- read_excel(path = fitxer_input, sheet = "Sheet1")
# ğŸ—“ï¸ Neteja la columna 'date'
if ("date" %in% colnames(dades)) {
dades$date <- sapply(dades$date, neteja_data)
}
# ğŸ’¨ Formatar la columna 'wind_speed_m_s'
if ("wind_speed_m_s" %in% colnames(dades)) {
dades$wind_speed_m_s <- sapply(dades$wind_speed_m_s, formata_velocitat)
}
# ğŸ—‘ï¸ Elimina la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# ğŸ’¾ Guardem el fitxer corregit
write_xlsx(dades, path = fitxer_output)
# âœ… Missatge d'estat
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
print("ğŸš€ Processament finalitzat per a tots els fitxers.")
ruta_input <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Originals/"
ruta_output <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Corregits/"
# âœ… FunciÃ³ per netejar la data (elimina tot desprÃ©s del primer espai)
neteja_data <- function(data) {
return(sub(" .*", "", data))
}
# âœ… FunciÃ³ per formatar la velocitat del vent
formata_velocitat <- function(x) {
x_sense_punts <- gsub("[.,]", "", x)  # Elimina punts i comes
# Convertim a numÃ¨ric
num <- as.numeric(x_sense_punts)
# Si tÃ© mÃ©s de 12 dÃ­gits, dividim per 1e15 per ajustar el format
if (!is.na(num) && nchar(x_sense_punts) > 12) {
return(formatC(num / 1e18, digits = 3, format = "f", decimal.mark = ","))
}
# Si Ã©s un nÃºmero petit, simplement el retornem amb 3 decimals
return(formatC(num, digits = 3, format = "f", decimal.mark = ","))
}
# ğŸš€ Bucle per processar els fitxers de 1981 fins a 2024
for (any in 1981:2024) {
# ğŸ“¥ Fitxers d'entrada i sortida
fitxer_input <- paste0(ruta_input, "Taula_velocitat_vent_", any, "_Andorra.xlsx")
fitxer_output <- paste0(ruta_output, "Taula_velocitat_vent_", any, "_Andorra_CORREGIT.xlsx")
# ğŸ” Verifiquem si el fitxer existeix
if (file.exists(fitxer_input)) {
# ğŸ“Š Llegim el fitxer Excel (fulla Sheet1)
dades <- read_excel(path = fitxer_input, sheet = "Sheet1")
# ğŸ—“ï¸ Neteja la columna 'date'
if ("date" %in% colnames(dades)) {
dades$date <- sapply(dades$date, neteja_data)
}
# ğŸ’¨ Formatar la columna 'wind_speed_m_s'
if ("wind_speed_m_s" %in% colnames(dades)) {
dades$wind_speed_m_s <- sapply(dades$wind_speed_m_s, formata_velocitat)
}
# ğŸ—‘ï¸ Elimina la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# ğŸ’¾ Guardem el fitxer corregit
write_xlsx(dades, path = fitxer_output)
# âœ… Missatge d'estat
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
print("ğŸš€ Processament finalitzat per a tots els fitxers.")
ruta_input <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Originals/"
ruta_output <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Corregits/"
# âœ… FunciÃ³ per netejar la data (elimina tot desprÃ©s del primer espai)
neteja_data <- function(data) {
return(sub(" .*", "", data))
}
# âœ… FunciÃ³ per formatar la velocitat del vent
formata_velocitat <- function(x) {
x_sense_punts <- gsub("[.,]", "", x)  # Elimina punts i comes
# Convertim a numÃ¨ric
num <- as.numeric(x_sense_punts)
# Si tÃ© mÃ©s de 12 dÃ­gits, dividim per 1e15 per ajustar el format
if (!is.na(num) && nchar(x_sense_punts) > 12) {
return(formatC(num / 1e20, digits = 3, format = "f", decimal.mark = ","))
}
# Si Ã©s un nÃºmero petit, simplement el retornem amb 3 decimals
return(formatC(num, digits = 3, format = "f", decimal.mark = ","))
}
# ğŸš€ Bucle per processar els fitxers de 1981 fins a 2024
for (any in 1981:2024) {
# ğŸ“¥ Fitxers d'entrada i sortida
fitxer_input <- paste0(ruta_input, "Taula_velocitat_vent_", any, "_Andorra.xlsx")
fitxer_output <- paste0(ruta_output, "Taula_velocitat_vent_", any, "_Andorra_CORREGIT.xlsx")
# ğŸ” Verifiquem si el fitxer existeix
if (file.exists(fitxer_input)) {
# ğŸ“Š Llegim el fitxer Excel (fulla Sheet1)
dades <- read_excel(path = fitxer_input, sheet = "Sheet1")
# ğŸ—“ï¸ Neteja la columna 'date'
if ("date" %in% colnames(dades)) {
dades$date <- sapply(dades$date, neteja_data)
}
# ğŸ’¨ Formatar la columna 'wind_speed_m_s'
if ("wind_speed_m_s" %in% colnames(dades)) {
dades$wind_speed_m_s <- sapply(dades$wind_speed_m_s, formata_velocitat)
}
# ğŸ—‘ï¸ Elimina la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# ğŸ’¾ Guardem el fitxer corregit
write_xlsx(dades, path = fitxer_output)
# âœ… Missatge d'estat
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
print("ğŸš€ Processament finalitzat per a tots els fitxers.")
ruta_input <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Originals/"
ruta_output <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Corregits/"
# âœ… FunciÃ³ per netejar la data (elimina tot desprÃ©s del primer espai)
neteja_data <- function(data) {
return(sub(" .*", "", data))
}
# âœ… FunciÃ³ per formatar la velocitat del vent
formata_velocitat <- function(x) {
x_sense_punts <- gsub("[.,]", "", x)  # Elimina punts i comes
# Convertim a numÃ¨ric
num <- as.numeric(x_sense_punts)
# Si tÃ© mÃ©s de 12 dÃ­gits, dividim per 1e15 per ajustar el format
if (!is.na(num) && nchar(x_sense_punts) > 12) {
return(formatC(num / 1e18, digits = 3, format = "f", decimal.mark = ","))
}
# Si Ã©s un nÃºmero petit, simplement el retornem amb 3 decimals
return(formatC(num, digits = 3, format = "f", decimal.mark = ","))
}
# ğŸš€ Bucle per processar els fitxers de 1981 fins a 2024
for (any in 1981:2024) {
# ğŸ“¥ Fitxers d'entrada i sortida
fitxer_input <- paste0(ruta_input, "Taula_velocitat_vent_", any, "_Andorra.xlsx")
fitxer_output <- paste0(ruta_output, "Taula_velocitat_vent_", any, "_Andorra_CORREGIT.xlsx")
# ğŸ” Verifiquem si el fitxer existeix
if (file.exists(fitxer_input)) {
# ğŸ“Š Llegim el fitxer Excel (fulla Sheet1)
dades <- read_excel(path = fitxer_input, sheet = "Sheet1")
# ğŸ—“ï¸ Neteja la columna 'date'
if ("date" %in% colnames(dades)) {
dades$date <- sapply(dades$date, neteja_data)
}
# ğŸ’¨ Formatar la columna 'wind_speed_m_s'
if ("wind_speed_m_s" %in% colnames(dades)) {
dades$wind_speed_m_s <- sapply(dades$wind_speed_m_s, formata_velocitat)
}
# ğŸ—‘ï¸ Elimina la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# ğŸ’¾ Guardem el fitxer corregit
write_xlsx(dades, path = fitxer_output)
# âœ… Missatge d'estat
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
print("ğŸš€ Processament finalitzat per a tots els fitxers.")
ruta_input <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Originals/"
ruta_output <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Corregits/"
# âœ… FunciÃ³ per netejar la data (elimina tot desprÃ©s del primer espai)
neteja_data <- function(data) {
return(sub(" .*", "", data))
}
# âœ… FunciÃ³ per formatar la velocitat del vent
formata_velocitat <- function(x) {
x_sense_punts <- gsub("[.,]", "", x)  # Elimina punts i comes
# Convertim a numÃ¨ric
num <- as.numeric(x_sense_punts)
# Si tÃ© mÃ©s de 12 dÃ­gits, dividim per 1e15 per ajustar el format
if (!is.na(num) && nchar(x_sense_punts) > 12) {
return(formatC(num / 1e19, digits = 3, format = "f", decimal.mark = ","))
}
# Si Ã©s un nÃºmero petit, simplement el retornem amb 3 decimals
return(formatC(num, digits = 3, format = "f", decimal.mark = ","))
}
# ğŸš€ Bucle per processar els fitxers de 1981 fins a 2024
for (any in 1981:2024) {
# ğŸ“¥ Fitxers d'entrada i sortida
fitxer_input <- paste0(ruta_input, "Taula_velocitat_vent_", any, "_Andorra.xlsx")
fitxer_output <- paste0(ruta_output, "Taula_velocitat_vent_", any, "_Andorra_CORREGIT.xlsx")
# ğŸ” Verifiquem si el fitxer existeix
if (file.exists(fitxer_input)) {
# ğŸ“Š Llegim el fitxer Excel (fulla Sheet1)
dades <- read_excel(path = fitxer_input, sheet = "Sheet1")
# ğŸ—“ï¸ Neteja la columna 'date'
if ("date" %in% colnames(dades)) {
dades$date <- sapply(dades$date, neteja_data)
}
# ğŸ’¨ Formatar la columna 'wind_speed_m_s'
if ("wind_speed_m_s" %in% colnames(dades)) {
dades$wind_speed_m_s <- sapply(dades$wind_speed_m_s, formata_velocitat)
}
# ğŸ—‘ï¸ Elimina la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# ğŸ’¾ Guardem el fitxer corregit
write_xlsx(dades, path = fitxer_output)
# âœ… Missatge d'estat
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
print("ğŸš€ Processament finalitzat per a tots els fitxers.")
# ğŸ“‚ Definim les rutes base
ruta_input <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Originals/"
ruta_output <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Corregits/"
formata_nuvolositat <- function(x) {
x_sense_punts <- gsub("[.,]", "", x)  # Eliminar punts i comes
# Si tÃ© exactament 17 dÃ­gits, eliminem el primer dÃ­git
if (nchar(x_sense_punts) == 17) {
x_sense_punts <- substr(x_sense_punts, 2, nchar(x_sense_punts))
}
# Si tÃ© mÃ©s de 10 dÃ­gits, dividir per 1e12 per ajustar el format
if (nchar(x_sense_punts) > 10) {
num <- as.numeric(x_sense_punts)
return(formatC(num / 1e18, digits = 3, format = "f", decimal.mark = ","))
}
return(x)  # Retornar el valor original si no cal formatar
}
# Bucle per processar els fitxers des de 2000 fins a 2022
for (any in 1981:1983) {
# Noms dels fitxers d'entrada i sortida
fitxer_input <- paste0(ruta_input, "Taula_Velocitat_vent_", any, "_Andorra.xlsx")
fitxer_output <- paste0(ruta_output, "Taula_Velocitat_vent_", any, "_Andorra_CORREGIT.xlsx")
# Verifiquem si el fitxer existeix
if (file.exists(fitxer_input)) {
# Llegim el fitxer Excel de la fulla 'Sheet1'
dades <- read_excel(path = fitxer_input, sheet = "Sheet1")
# 1ï¸âƒ£ Formatar la columna 'percent_nuvolositat'
dades$wind_speed_m_s <- sapply(dades$wind_speed_m_s, formata_velocitat)
# 2ï¸âƒ£ Eliminar la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# Guardem el fitxer corregit a la carpeta "Corregits"
write_xlsx(dades, path = fitxer_output)
# Missatge per indicar el progrÃ©s
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
print("ğŸš€ Processament finalitzat per a tots els fitxers.")
ruta_input <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Originals/"
ruta_output <- "C:/Users/aquintana/Desktop/ARI/CIT/Velocitat_vent_ERA5_land/Corregits/"
# âœ… FunciÃ³ actualitzada per formatar 'velocitat_vent'
formata_nuvolositat <- function(x) {
x_sense_punts <- gsub("[.,]", "", x)  # Eliminar punts i comes
# Si tÃ© exactament 17 dÃ­gits, eliminem el primer dÃ­git
if (nchar(x_sense_punts) == 17) {
x_sense_punts <- substr(x_sense_punts, 2, nchar(x_sense_punts))
}
# Si tÃ© mÃ©s de 10 dÃ­gits, dividir per 1e12 per ajustar el format
if (nchar(x_sense_punts) > 10) {
num <- as.numeric(x_sense_punts)
return(formatC(num / 1e18, digits = 3, format = "f", decimal.mark = ","))
}
return(x)  # Retornar el valor original si no cal formatar
}
# Bucle per processar els fitxers des de 2000 fins a 2022
for (any in 1981:2024) {
# Noms dels fitxers d'entrada i sortida
fitxer_input <- paste0(ruta_input, "Taula_Velocitat_vent_", any, "_Andorra.xlsx")
fitxer_output <- paste0(ruta_output, "Taula_Velocitat_vent_", any, "_Andorra_CORREGIT.xlsx")
# Verifiquem si el fitxer existeix
if (file.exists(fitxer_input)) {
# Llegim el fitxer Excel de la fulla 'Sheet1'
dades <- read_excel(path = fitxer_input, sheet = "Sheet1")
# 1ï¸âƒ£ Formatar la columna 'percent_nuvolositat'
dades$wind_speed_m_s <- sapply(dades$wind_speed_m_s, formata_velocitat)
# 2ï¸âƒ£ Eliminar la columna '.geo' si existeix
if (".geo" %in% colnames(dades)) {
dades <- dades %>% select(-.geo)
}
# Guardem el fitxer corregit a la carpeta "Corregits"
write_xlsx(dades, path = fitxer_output)
# Missatge per indicar el progrÃ©s
cat("âœ… Fitxer de l'any", any, "processat i guardat com:", fitxer_output, "\n")
} else {
cat("âš ï¸ Fitxer no trobat per l'any:", any, "\n")
}
}
print("ğŸš€ Processament finalitzat per a tots els fitxers.")
